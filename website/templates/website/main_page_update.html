
{% extends "layout/base_crm.html" %}
{% load static %}

{% block additionaly_css %}
    <style>
        .column-center {
            margin-top: 5pt;
        }
    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha256-rByPlHULObEjJ6XQxW/flG2r+22R5dKiAoef+aXWfik=" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="{% static 'appartments/plugins/summernote/summernote.min.css' %}">

{% endblock additionaly_css %}
{% block additionaly_js %}

    <script src="{% static 'appartments/plugins/summernote/summernote.min.js' %}"></script>
    <script src="{% static 'appartments/plugins/summernote/lang/summernote-ru-RU.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha256-KM512VNnjElC30ehFwehXjx1YCHPiQkOPmqnrWtpccM=" crossorigin="anonymous"></script>

{% endblock additionaly_js %}


{% block title %}
    <title> Главная страница </title>
{% endblock title %}

{% block content-header %}
    <h1> Главная страница </h1>
{% endblock %}

{% block content %}

<form enctype="multipart/form-data" method="post">



    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title">Редактирование страницы "Главная"</h3>
            <div class="box-tools">
                <a href="#" class="btn btn-default btn-sm updateSeoFiles">
                    <span class="hidden-xs">Обновить robots и sitemap</span><i class="fa fa-refresh visible-xs" aria-hidden="true"></i>
                </a>
            </div>
        </div>

        <div class="box-body">
                {% csrf_token %}
                <h3 class="page-header">Слайдер</h3>
                <div class="row">
                    {{ main_slider_formset.management_form }}
                    {% for main_slider_form in main_slider_formset %}
                        {% for hidden in main_slider_form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        <div class="col-md-4">
                            <h4>Слайд {{ forloop.counter }}</h4>
                            {% if main_slider_form.instance.image %}
                                <img src="{{ main_slider_form.instance.image.url }}" alt="" class="img-responsive margin-bottom-15">
                            {% else %}
                                <img src="{% static 'website/img/empty_slide_image.jpg' %}" alt="" class="img-responsive margin-bottom-15">
                            {% endif %}
                            <label>{{main_slider_form.image.label}}</label>
                            <p>{{ main_slider_form.image }}</p>
                        </div>
                    {% endfor %}    
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <h3 class="page-header">Краткая информация</h3>
                        <div class="form-group">
                            <p><label>{{ main_form.title.label }}</label></p>
                            {{ main_form.title }}
                        </div>
                        <div class="form-group">
                            <p><label>{{ main_form.short_descriptions.label }}</label></p>
                            <p>{{ main_form.short_descriptions }}</p>
                        </div>
                        <div class="form-group">
                            {{ main_form.show_app_link }} <label>{{ main_form.show_app_link.label }}</label>
                        </div>
                    </div>
                </div>
                
                <h3 class="page-header">Рядом с Вами</h3>
                <div class="row">
                    {{ round_us_slider_formset.management_form }}
                    {% for round_slider_form in round_us_slider_formset %}
                        {% for hidden in round_slider_form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        <div class="col-md-4">
                            <h4>Блок {{ forloop.counter }}</h4>


                            {% if round_slider_form.instance.image %}
                                <img src="{{ round_slider_form.instance.image.url }}" alt="" class="img-responsive margin-bottom-15">
                            {% else %}
                                <img src="{% static 'website/img/empty_slide_image.jpg' %}" alt="" class="img-responsive margin-bottom-15">
                            {% endif %}
                            <label>{{round_slider_form.image.label}}</label>
                            <p>{{ round_slider_form.image }}</p>
                            <p>{{ round_slider_form.title }}</p>
                            <p>{{ round_slider_form.description }}</p>

                        </div>
                    {% endfor %}    
                </div>

                {% comment %} <---------------WORK-AREA------------------------> {% endcomment %}
                <div class="row">
                    <div class="col-md-12">
                        <label>{{ seo_block_form.title.label }}</label>
                        <p>{{ seo_block_form.title }}</p>
                        <label>{{ seo_block_form.description.label }}</label>
                        <p>{{ seo_block_form.description }}</p>
                        <label>{{ seo_block_form.keyword.label }}</label>
                        <p>{{ seo_block_form.keyword }}</p>
                    </div>
                </div>
                {% comment %} <---------------WORK-AREA------------------------> {% endcomment %}
                </div>
                <div class="row">
                    <div class="col-xs-6 text-right">
                        <div class="form-group">
                            <a class="btn btn-default" href="#">Отменить</a>
                            <button type="submit" class="btn btn-success">Сохранить</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</form>



<script>
    $(document).ready(function () {

    var DefaultStyleButton = function (context) {
        var ui = $.summernote.ui;
        var event = ui.buttonGroup([
            ui.button({
                contents: '<i class="fa fa-font"/><span>   Обычный текст   </span><b class="caret"></b>',
                data: {
                    toggle: 'dropdown'
                }
            }),
            ui.dropdown({
                items: [
                    'Обычный текст',
                    'Заголовок 1',
                    'Заголовок 2',
                    'Заголовок 3',
                    'Заголовок 4',
                    'Заголовок 5',
                    'Заголовок 6',
                ],
            callback: function (items) {
                $(items).find('li a').on('click', function(){
                    var changed_option_text = $(this).attr('data-value')
                    $(this).closest('ul').prev().find('span').text(changed_option_text)
                    if (changed_option_text == 'Обычный текст') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatPara');
                    } else if (changed_option_text == 'Заголовок 1') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH1')
                    } else if (changed_option_text == 'Заголовок 2') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH2')
                    } else if (changed_option_text == 'Заголовок 3') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH3')
                    } else if (changed_option_text == 'Заголовок 4') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH4')
                    } else if (changed_option_text == 'Заголовок 5') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH5')
                    } else if (changed_option_text == 'Заголовок 6') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH6')
                    }
                    })
                    }
            })
        ]);
        return event.render();
    }
    
    
    var CustomBold = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: '<strong>Полужирный</strong>',
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('bold')
            }
        });
        return button.render();
        }
    
    
    var CustomItalic = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: '<i>Курсивный</i>',
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('italic')
            }
        });
        return button.render();
        }
    
    var CustomUnderline = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: '<u>Подчеркнутый</u>',
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('underline')
            }
        });
        return button.render();
        }
    
    var CustomIndent = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: "<span class='fa fa-indent'></span>",
            tooltip: "Увеличить отступ",
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('indent')
            }
        });
        return button.render();
        }
    
    var CustomOutdent = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: "<span class='fa fa-outdent'></span>",
            tooltip: "Уменьшить отступ",
            click: function () {

            $(this).closest('p').find('#short_descriptions_field').summernote('outdent')

            }
        });
        return button.render();
        }
    


    $('*[id=short_descriptions_field]').summernote({
        toolbar: [
            ['style', ['style_cliche']],
            ['font', ['custom_bold', 'custom_italic', 'custom_underline']],
            ['para', ['ul', 'ol', 'custom_outdent', 'custom_indent']],
        ],

        callbacks: {
            onChange: function (contents, $editable) {
                var markup = $('#short_descriptions_field').summernote('code');
            }
        },

        buttons: {
            style_cliche: DefaultStyleButton,
            custom_bold: CustomBold,
            custom_italic: CustomItalic,
            custom_underline: CustomUnderline,
            custom_indent: CustomIndent,
            custom_outdent: CustomOutdent,
            },

        lang: 'ru-RU',
        placeholder: 'Текст сообщения:',
        tabsize: 2,
        height: 150
        });


    $(".box-body").on('change', "input[name$='image']", function () {
        console.log(this);
        var input = $(this);
        console.log($(input));
        var output = $(this).closest('div').find("img[class^='img-responsive']")
        console.log(output);
        var reader = new FileReader();
        reader.onload = function () {
            output.attr("src", reader.result);
        };
        reader.readAsDataURL(input[0].files[0]);
    });

    $('li[aria-label]').each(function(){
        $(this).find('a').attr('href', 'javascript:;')
    })



});
</script>
{% endblock content %}