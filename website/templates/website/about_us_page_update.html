
{% extends "layout/base_crm.html" %}
{% load static %}

{% block additionaly_css %}
    <style>
        .column-center {
            margin-top: 5pt;
        }
    </style>
    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha256-rByPlHULObEjJ6XQxW/flG2r+22R5dKiAoef+aXWfik=" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="{% static 'appartments/plugins/summernote/summernote.min.css' %}">

{% endblock additionaly_css %}
{% block additionaly_js %}

    <script src="{% static 'appartments/plugins/summernote/summernote.min.js' %}"></script>
    <script src="{% static 'appartments/plugins/summernote/lang/summernote-ru-RU.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha256-KM512VNnjElC30ehFwehXjx1YCHPiQkOPmqnrWtpccM=" crossorigin="anonymous"></script>

{% endblock additionaly_js %}


{% block title %}
    <title> О нас </title>
{% endblock title %}

{% block content-header %}
    <h1> О нас </h1>
{% endblock %}

{% block content %}

<form enctype="multipart/form-data" method="post">



    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title">Редактирование страницы "О нас"</h3>
        </div>

        <div class="box-body">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-8">
                        <h3 class="page-header">Информация</h3>
                        <div class="form-group">
                            <p><label>{{ main_form.title.label }}</label></p>
                            {{ main_form.title }}
                        </div>
                        <div class="form-group">
                            <p><label>{{ main_form.short_description.label }}</label></p>
                            <p>{{ main_form.short_description }}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h4>Фото директора</h4>
                        {% if main_form.instance.director_photo %}
                                <img src="{{ main_form.instance.director_photo.url }}" alt="" class="img-responsive margin-bottom-15">
                        {% else %}
                                <img src="{% static 'website/img/empty_slide_image.jpg' %}" alt="" class="img-responsive margin-bottom-15">
                        {% endif %}
                        {{ main_form.director_photo }}
                    </div>
                </div>

                <div class="row" id="photo_galery">
                    <div class="col-xs-12">
                        <h3 class="page-header">Фотогалерея</h3>
                    </div>
                    {{ photo_gallery_about_us_formset.management_form }}
                    {% for photo_form in photo_gallery_about_us_formset %}
                        {% for hidden in photo_form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        <div class="col-xs-4 col-sm-2 text-center">
                            {% if photo_form.instance.image %}
                                <img src="{{ photo_form.instance.image.url }}" alt="" class="img-responsive margin-bottom-15 img-thumbnail">
                            {% endif %}
                            {{ photo_form.image }}
                            <div class="form-group margin-bottom-15">
                                <a href="javascript:;" id="delete_button"><i class="fa fa-trash text-red" aria-hidden="true"></i></a>
                            </div>
                            {{ photo_form.DELETE }}
                        </div>
                    {% endfor %}

                    <div id="empty_form_container">
                        <div class="col-xs-4 col-sm-2 text-center">
                            <img src="javascript:;" alt="" class="img-responsive margin-bottom-15">
                            {{ photo_gallery_about_us_formset.empty_form.image }}
                            <div class="form-group margin-bottom-15">
                                <a href="javascript:;" id="delete_button"><i class="fa fa-trash text-red" aria-hidden="true"></i></a>
                            </div>
                            {{ photo_gallery_about_us_formset.empty_form.DELETE }}
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-xs-4 text-center" id='add_simple_button_container'>
                        <a class='btn btn-default' href="javascript:;" id='add_photogallery'>добавить фотографию</a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <h3 class="page-header">Дополнительная информация</h3>
                        <div class="form-group">
                            <p><label>{{ main_form.addition_title.label }}</label></p>
                            {{ main_form.addition_title }}
                        </div>
                        <div class="form-group">
                            <p><label>{{ main_form.addition_short_description.label }}</label></p>
                            <p>{{ main_form.addition_short_description }}</p>
                        </div>
                    </div>
                </div>

                <div class="row" id="photo_galery">
                    <div class="col-xs-12">
                        <h3 class="page-header">Дополнительная фотогалерея</h3>
                    </div>
                    {{ additional_gallery_about_us_formset.management_form }}
                    {% for photo_form in additional_gallery_about_us_formset %}
                        {% for hidden in photo_form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        <div class="col-xs-4 col-sm-2 text-center">
                            {% if photo_form.instance.image %}
                                <img src="{{ photo_form.instance.image.url }}" alt="" class="img-responsive margin-bottom-15 img-thumbnail">
                            {% endif %}
                            {{ photo_form.image }}
                            <div class="form-group margin-bottom-15">
                                <a href="javascript:;" id="delete_button"><i class="fa fa-trash text-red" aria-hidden="true"></i></a>
                            </div>
                            {{ photo_form.DELETE }}
                        </div>
                    {% endfor %}

                    <div id="empty_form_container">
                        <div class="col-xs-4 col-sm-2 text-center">
                            <img src="javascript:;" alt="" class="img-responsive margin-bottom-15">
                            {{ additional_gallery_about_us_formset.empty_form.image }}
                            <div class="form-group margin-bottom-15">
                                <a href="javascript:;" id="delete_button"><i class="fa fa-trash text-red" aria-hidden="true"></i></a>
                            </div>
                            {{ additional_gallery_about_us_formset.empty_form.DELETE }}
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-xs-4 text-center" id='add_adition_button_container'>
                        <a class='btn btn-default' href="javascript:;" id='add_photogallery'>добавить фотографию</a>
                    </div>
                </div>
                {% comment %} ======================WORK======AREA===================== {% endcomment %}
                <div class="row">
                    <div class="col-md-12">
                        <h3 class="page-header">Документы</h3>
                    </div>
                    <div class="col-xs-12 col-md-6" id="documents_block">

                        {{ documents_about_us_formset.management_form }}
                        {% for documents_form in documents_about_us_formset %}
                            {% for hidden in documents_form.hidden_fields %}
                                {{ hidden }}
                            {% endfor %}
                        <div class="row">
                            <div class="col-xs-12" id="doc-row">

                                <div class="form-group">
                                    <div class="pull-right text-red">
                                        <a href="javascript:;" id="delete_button">
                                            <i class="fa fa-trash"></i>
                                        </a>
                                    </div>
                                    {{ documents_form.DELETE }}
                                    <p>{{ documents_form.instance.file }}</p>
                                    {% if documents_form.instance.file %}
                                        <img class="fa fa-3x pull-left" style="width:32px; hight:42px; fit:crop" src="{{ documents_form.instance.file.url }}" alt="">
                                    {% else %}
                                        <img class="fa fa-3x pull-left" style="width:32px; hight:42px; fit:crop" src="{% static 'appartments/img/empty_image.jpeg' %}" alt="">
                                    {% endif %}
                                    <label>{{ documents_form.file.label }}</label>
                                    {{ documents_form.file }}
                                </div>  
                                <div class="form-group">
                                    <label>{{ documents_form.title.label }}</label>
                                    {{ documents_form.title }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        <div id="empty_form_container">
                            {% comment %} <div class="row"> {% endcomment %}
                                <div class="col-xs-12" id="doc-row">
                                    <div class="form-group">
                                        <div class="pull-right text-red">
                                            <a href="javascript:;" id="delete_button">
                                                <i class="fa fa-trash"></i>
                                            </a>
                                        </div>
                                        {{ documents_about_us_formset.empty_form.DELETE }}
                                        <img class="fa fa-3x pull-left" style="width:32px; hight:42px; fit:crop" src="{% static 'appartments/img/empty_image.jpeg' %}" alt="">
                                        <label>{{ documents_about_us_formset.empty_form.file.label }}</label>
                                        {{ documents_about_us_formset.empty_form.file }}
                                    </div>  
                                    <div class="form-group">
                                        <label>{{ documents_about_us_formset.empty_form.title.label }}</label>
                                        {{ documents_about_us_formset.empty_form.title }}
                                    </div>
                                {% comment %} </div> {% endcomment %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-4 text-center" id='add_document_button_container'>
                                <a class='btn btn-default' href="javascript:;" id='add_document'>добавить документ</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% comment %} ===============END====WORK======AREA===================== {% endcomment %}
                <div class="row">
                    <div class="col-md-12">
                        <label>{{ seo_block_form.title.label }}</label>
                        <p>{{ seo_block_form.title }}</p>
                        <label>{{ seo_block_form.description.label }}</label>
                        <p>{{ seo_block_form.description }}</p>
                        <label>{{ seo_block_form.keyword.label }}</label>
                        <p>{{ seo_block_form.keyword }}</p>
                    </div>
                </div>

                </div>
                <div class="row">
                    <div class="col-xs-6 text-right">
                        <div class="form-group">
                            <a class="btn btn-default" href="#">Отменить</a>
                            <button type="submit" class="btn btn-success">Сохранить</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</form>



<script>
    $(document).ready(function () {

    var DefaultStyleButton = function (context) {
        var ui = $.summernote.ui;
        var event = ui.buttonGroup([
            ui.button({
                contents: '<i class="fa fa-font"/><span>   Обычный текст   </span><b class="caret"></b>',
                data: {
                    toggle: 'dropdown'
                }
            }),
            ui.dropdown({
                items: [
                    'Обычный текст',
                    'Заголовок 1',
                    'Заголовок 2',
                    'Заголовок 3',
                    'Заголовок 4',
                    'Заголовок 5',
                    'Заголовок 6',
                ],
            callback: function (items) {
                $(items).find('li a').on('click', function(){
                    var changed_option_text = $(this).attr('data-value')
                    $(this).closest('ul').prev().find('span').text(changed_option_text)
                    if (changed_option_text == 'Обычный текст') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatPara');
                    } else if (changed_option_text == 'Заголовок 1') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH1')
                    } else if (changed_option_text == 'Заголовок 2') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH2')
                    } else if (changed_option_text == 'Заголовок 3') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH3')
                    } else if (changed_option_text == 'Заголовок 4') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH4')
                    } else if (changed_option_text == 'Заголовок 5') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH5')
                    } else if (changed_option_text == 'Заголовок 6') {
                        $(this).closest('p').find('#short_descriptions_field').summernote('formatH6')
                    }
                    })
                    }
            })
        ]);
        return event.render();
    }
    
    
    var CustomBold = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: '<strong>Полужирный</strong>',
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('bold')
            }
        });
        return button.render();
        }
    
    
    var CustomItalic = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: '<i>Курсивный</i>',
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('italic')
            }
        });
        return button.render();
        }
    
    var CustomUnderline = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: '<u>Подчеркнутый</u>',
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('underline')
            }
        });
        return button.render();
        }
    
    var CustomIndent = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: "<span class='fa fa-indent'></span>",
            tooltip: "Увеличить отступ",
            click: function () {
                $(this).closest('p').find('#short_descriptions_field').summernote('indent')
            }
        });
        return button.render();
        }
    
    var CustomOutdent = function (context) {
        var ui = $.summernote.ui;
        var button = ui.button({
            contents: "<span class='fa fa-outdent'></span>",
            tooltip: "Уменьшить отступ",
            click: function () {

            $(this).closest('p').find('#short_descriptions_field').summernote('outdent')

            }
        });
        return button.render();
        }
    


    $('*[id=short_descriptions_field]').summernote({
        toolbar: [
            ['style', ['style_cliche']],
            ['font', ['custom_bold', 'custom_italic', 'custom_underline']],
            ['para', ['ul', 'ol', 'custom_outdent', 'custom_indent']],
        ],

        callbacks: {
            onChange: function (contents, $editable) {
                var markup = $('#short_descriptions_field').summernote('code');
            }
        },

        buttons: {
            style_cliche: DefaultStyleButton,
            custom_bold: CustomBold,
            custom_italic: CustomItalic,
            custom_underline: CustomUnderline,
            custom_indent: CustomIndent,
            custom_outdent: CustomOutdent,
            },

        lang: 'ru-RU',
        placeholder: 'Текст сообщения:',
        tabsize: 2,
        height: 150
        });


    $('li[aria-label]').each(function(){
        $(this).find('a').attr('href', 'javascript:;')
    })

    
    $(".box-body").on('change', "input[name$='image']", function () {
        var input = $(this);
        var output = $(this).closest('div').find("img[class^='img-responsive']")
        var reader = new FileReader();
        reader.onload = function () {
            output.attr("src", reader.result);
        };
        reader.readAsDataURL(input[0].files[0]);
    });


    $("a[id^='add_']").click(function(){
        console.log('tou click!')
        var current_form_container = $(this).closest("div[class='row']").prev()
        var form_index = $(current_form_container).find("input[id$='TOTAL_FORMS']").val()
        if($(this).parent().attr('id') == "add_simple_button_container"){
            var new_form = $(current_form_container).find('#empty_form_container').html().replace(/__prefix__/g, form_index);
            $(current_form_container).append(new_form)
            $(`input[id$='about_us_formset-${form_index}-image']`).closest('div').hide()
            $(`input[id$='about_us_formset-${form_index}-image']`).click()    
            $(`input[id$='about_us_formset-${form_index}-image']`).change(function(){
            $(`input[id$='about_us_formset-${form_index}-image']`).closest('div').show()
            $(current_form_container).find("input[id$='TOTAL_FORMS']").val(parseInt(form_index) + 1)
            })
        } else if ($(this).parent().attr('id') == "add_adition_button_container") {
            var new_form = $(current_form_container).find('#empty_form_container').html().replace(/__prefix__/g, form_index);
            $(current_form_container).append(new_form)
            $(`input[id$='id_additional_gallery_about_us_formset-${form_index}-image']`).closest('div').hide()
            $(`input[id$='id_additional_gallery_about_us_formset-${form_index}-image']`).click()
            $(`input[id$='id_additional_gallery_about_us_formset-${form_index}-image']`).change(function(){
            $(`input[id$='id_additional_gallery_about_us_formset-${form_index}-image']`).closest('div').show()
            $(current_form_container).find("input[id$='TOTAL_FORMS']").val(parseInt(form_index) + 1)
            })
        } else if ($(this).parent().attr('id') == "add_document_button_container"){
            var current_form_container = $(this).closest("div[class='row']").parent()
            var form_index = $(current_form_container).closest('#documents_block').find("input[id$='TOTAL_FORMS']").val()
            var new_form = $(current_form_container).find('#empty_form_container').html().replace(/__prefix__/g, form_index);
            $(new_form).insertBefore($(this).parent())
            $(current_form_container).find("input[id$='TOTAL_FORMS']").val(parseInt(form_index) + 1)
        }
    })


    $("div[id=photo_galery]").on('click', "img", function(){
        $(this).closest('div').find("input[id^=id_photo_gallery], input[id^=id_additional_gallery]").first().click()
    })


    $("div[id=photo_galery], div[id=documents_block]").on('click', '#delete_button', function(){
        $(this).parent().next().trigger('click');
        if($(this).closest($(this).closest("#doc-row")).length != 0){
            $(this).closest("#doc-row").hide()
        } else {
            $(this).closest("div[class^='col-']").hide()
        }
    })


    $("input[id^='id_photo_gallery_about_us'], input[id^='id_additional_gallery'], input[id$='-DELETE']").hide()
    $("div[id=empty_form_container]").hide()



});
</script>
{% endblock content %}